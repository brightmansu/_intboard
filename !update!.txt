ОБНОВЛЕНИЕ INTELLECT BOARD С ПРЕДЫДУЩИХ ВЕРСИЙ

1. Общие рекомендации

Перед обновлением рекомендуется выполнить резервную копию базы данных форума,
причем, если есть возможность, делать это не встроенными в форум средствами,
а средствами PHPMyAdmin или ему подобных скриптов.

Порядок обновления:

1. Рекомендуется снять резервную копию базы форума на случай, если придется делать откат.
2. Рекомендуется закрыть форум на период обновления.
3. Загрузить поверх старой версии новую с перезаписью всех файлов (кроме rules.txt в langs/*/ или модифицированных шаблонов писем).
4. Запустить install.php в режиме обновления.
5. В случае, если предыдущие попытки обновления завершились ошибками, исправить ошибки в SQL-запросах в файле db/mysql219.sql (для ошибки , а также удалить все запросы, которые предшествовали тому, на котором произошла ошибка (так как один раз они уже выполнились).
6. Открыть форум.

2. Особенности перехода до версии 2.22
Переход с версии 2.20 до версии 2.22 не требует дополнительных действий в обязательном порядке. Однако в целях предотвращения несанкционированного обращения к рекомендуется выполнить следующие запросы (примечание: они будут работать только на версиях MySQL, поддерживающих подзапросы, т.е. 4.1 и выше):

UPDATE prefix_File SET file_key=FLOOR(2000000000*RAND());

UPDATE prefix_File SET file_key=0 WHERE file_id IN (SELECT u__pavatar_id FROM prefix_User)

UPDATE prefix_File SET file_key=0 WHERE file_id IN (SELECT u__photo_id FROM prefix_User)

При обновлении с более старых версий требуется выполнить те же действия, что и при обновлении до 2.20.


3. Особенности перехода до версии 2.20

После обновления форума до версии 2.20 необходимо заново пересчитать статистику,
а также выполнить "канонизацию" имен пользователей (одноименный пункт в меню, который
появится после обновления).
Если нужно, провести настройку уровней для создания блогов и галерей (соответствующий пункт
меню станет виден только после обновления). По умолчанию блоги и галереи выключены
(стоит уровень 1024 -- System).

Примечание: для версии 2.20 на данный момент не доступно обновление для PostgreSQL.

4. Особенности обновления до версии 2.19

В версии 2.19 была существенно изменена система стилей по сравнению с 2.18. Это было сделано по двум причинам: из соображения уменьшения объема HTML-кода, а также в результате того, что появилось достаточно большое количество новых элементов. Три стандартных стиля (Default Style, Gradient Blue и Grey) входят в дистрибутив уже со всеми изменениями, однако если у вас есть другие стили, то в них необходимо будет внести следующие изменения:

заменить .basictable на .innertable td и перенести соответствующий класс в начало CSS-файла
заменить .tablehead на tr.tablehead td, td.tablehead
заменить .category на td.category
заменить .forumentry на td.forumentry
если не существует класса .postentry2, то заменить .postentry на .postentry, .postentry2
заменить .quote на blockquote (без точки в начале)
заменить .code на code (без точки в начале)

Проверить, существуют ли следующие стили (часть из них была добавлена в версии 2.18, часть -- в 2.19) и в случае необходимости добавить их в таком виде:

.sign { font-size: 10px; font-family: Verdana; color: #404040;}

.offtopic {  font-size: 10px; color: #333333 }

.hligh { font-weight: bold; color: #CC9933}

.postlinks { border-bottom:#93ADCA 1px solid; padding-bottom: 3px; margin-bottom: 3px; margin-right: 4px }

.postlinks2 { float: right; position: relative; margin-bottom: -1.6em; top: -1.6em; margin-right: 5px }

.online { font-weight: bold; font-size: 12px }

.posttable { border-collapse: collapse; width: 100%; border: #93ADCA 4px solid; table-layout: fixed }

.posttable td { border: #93ADCA 1px solid }

a.newpm, a.newpm:visited { text-decoration: blink; color: #DD0000; }

a.rules:link { font-size: 10px; font-family: Arial; color: black; }
a.rules:visited { font-size: 10px; font-family: Arial; color: black; }
a.rules:active { font-size: 10px; font-family: Arial; color: black; }
a.rules:hover { font-size: 10px; font-family: Arial; color: black; }

.photo_nav { overflow: auto; padding: 5px; vertical-align: center; text-align:center; white-space: nowrap; width: 96% }
.nav1 { display: inline; margin-right: 5px; margin-top: 2px }
.nav2 { display: inline; margin-right: 5px; border: #C00 2px solid }
.nav3 { display: inline; margin-right: 5px; margin-top: 2px }

.calendar_hday { color: #800 }
a.calendar_hday { color: #C00 }
a.calendar_hday:visited { color: #A00 }
a.calendar { color: #1E90FF }
a.calendar:visited { color: #1280EE }

Естественно, в описание стилей при необходимости можно вносить изменения.

Кроме этого,  была изменена система шаблонов форума. Отменено понятие шаблона быстрого вывода (теперь вместо него используется только файл message.php), и введено понятие общего шаблона форума, который представляет собой единый HTML-файл, в которой вставлены вызовы функций, ответственных за вывод соответствующей части контента. Такой файл находится в каждом стилевом каталоге,имеет имя template.php и доступен через "Редактирование стиля". Однако для старых стилей, которые были созданы для версий 2.18 и раньше, предусмотрен режим обратной совместимости, при котором используется общий шаблон config/tmplate1.php и функции из main.php (который включается по умолчанию для всех установленных в форуме стилей, кроме трех стандартных). За переключение между режимом единого шаблона и режимом обратной совместимости отвечает столбец st_integrated (0 -- обратная совместимость, 1 -- единый шаблон).

Кроме этого, также изменился порядок проверки правильности имен пользователей. Теперь можно задавать допустимый набор символов для имени пользователя вместо переключения "только латиница"/"любые символы", как в прежних версиях. После обновления обязательно проверьте, подходит ли набор символов по умолчанию для вашего форума.

5. Особенности обновления до версии 2.18

В версии 2.18 был произведен вынос прикрепленных файлов и фотографий из базы данных в обычные файлы. Поэтому при обновлении IntB с более старых версий небоходимо провести перенос файлов. Осуществляется это следующим образом: сразу после установки в режиме обновления в Центре Администрирования появится 2 новых пункта меню: "Перенос файлов" и "Перенос фото". Необходимо выбрать один из этих пунктов, после чего появится форма, состоящая из одной кнопки. После нажатия этой кнопки будет произведена конвертация файлов. Внимание: для того, чтобы не было превышения лимита времени выполнения скрипта, операция переноса разбита на шаги по 50 файлов каждый, поэтому после преобразования очередных файлов будет снова выведена та же форма с кнопкой, и кнопку нужно будет нажать повторно. После того, как будут преобразованы все файлы, будет выведено сообщение об успешном завершени и пункт для преобразования файлов - удален из статистики. Далее аналогичную процедуру следует повторить для фотографий.
Кроме этого, следует отметить, что в версии 2.18 пункт меню "Основные настройки" был разбит на 3 пункта: "Основные настройки", "Параметры работы" и "Файлы и фотографии".
Также в IntB 2.18 добавлено новый режим поиска по форуму Режим расширенного поиска позволяет использовать операторы + - * ~, а режим поиска с использованием неявного знания - позволяет добиться более точных результатов поиска. Режим расширенного поиска доступен только на MySQL 4.1 и выше.

6. Особенности обновления версии 2.13 и более ранних

В версии 2.14 был изменен способ подсчета статистики: в целях ускорения работы форумов с большими объемами баз данных статистика сделана частично хранимой, а не рассчитываемой в режиме реального времени при каждом просмотре. Всвязи с этим изменением после выполнения обновления версии форума произойдет обнуление всей статистики (и все темы станут невидимыми). Не волнуйтесь, ничего не пропало! Зайдите в Центр Администрирования и сделайте "Пересчет статистики" - все темы станут снова видны.
Также пересчет статистики следует выполнять после конвертации базы данных других форумов в Intellect Board.

